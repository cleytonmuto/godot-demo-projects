[gd_scene load_steps=25 format=3 uid="uid://blevel05"]

[ext_resource type="PackedScene" uid="uid://bplayer001" path="res://player/Player.tscn" id="1_player"]
[ext_resource type="PackedScene" uid="uid://benemy001" path="res://enemy/Enemy.tscn" id="2_enemy"]
[ext_resource type="PackedScene" uid="uid://bdoor001" path="res://interactables/ExitDoor.tscn" id="3_door"]
[ext_resource type="PackedScene" uid="uid://bhud001" path="res://ui/HUD.tscn" id="4_hud"]
[ext_resource type="Script" path="res://level/BackgroundGenerator.gd" id="5_bg"]
[ext_resource type="Script" path="res://level/LevelManager.gd" id="6_levelmgr"]
[ext_resource type="Script" path="res://level/LevelCamera.gd" id="14_camera"]
[ext_resource type="Script" path="res://level/MaskLighting.gd" id="15_lighting"]
[ext_resource type="Script" path="res://level/AmbientEffects.gd" id="16_ambient"]
[ext_resource type="PackedScene" uid="uid://claser001" path="res://interactables/LaserBarrier.tscn" id="17_laser"]
[ext_resource type="PackedScene" uid="uid://ccamera001" path="res://interactables/SecurityCamera.tscn" id="18_security"]
[ext_resource type="PackedScene" uid="uid://cpatrol001" path="res://interactables/PatrollingLaser.tscn" id="19_patrol"]
[ext_resource type="PackedScene" uid="uid://coneway001" path="res://interactables/OneWayDoor.tscn" id="20_oneway"]
[ext_resource type="PackedScene" uid="uid://cdetector001" path="res://enemy/DetectorEnemy.tscn" id="21_detector"]
[ext_resource type="PackedScene" uid="uid://chunter001" path="res://enemy/HunterEnemy.tscn" id="22_hunter"]
[ext_resource type="PackedScene" uid="uid://cmimic001" path="res://enemy/MimicEnemy.tscn" id="23_mimic"]
[ext_resource type="PackedScene" uid="uid://cindigo001" path="res://enemy/IndigoEnemy.tscn" id="26_indigo"]

[sub_resource type="RectangleShape2D" id="RectangleShape2D_wall_h"]
size = Vector2(2048, 16)

[sub_resource type="RectangleShape2D" id="RectangleShape2D_wall_v"]
size = Vector2(16, 768)

[sub_resource type="RectangleShape2D" id="RectangleShape2D_obstacle"]
size = Vector2(16, 200)

[sub_resource type="RectangleShape2D" id="RectangleShape2D_obstacle_small"]
size = Vector2(16, 120)

[sub_resource type="RectangleShape2D" id="RectangleShape2D_obstacle_horizontal"]
size = Vector2(220, 16)

[sub_resource type="RectangleShape2D" id="RectangleShape2D_bar_short_h"]
size = Vector2(80, 12)

[sub_resource type="RectangleShape2D" id="RectangleShape2D_bar_short_v"]
size = Vector2(12, 80)

[node name="Level05" type="Node2D"]

[node name="Camera2D" type="Camera2D" parent="."]
script = ExtResource("14_camera")
level_width = 2048.0
level_height = 768.0

[node name="LevelTitle" type="Label" parent="."]
offset_left = 32.0
offset_top = 620.0
offset_right = 460.0
offset_bottom = 750.0
theme_override_colors/font_color = Color(0.3, 0.3, 0.3, 1)
theme_override_font_sizes/font_size = 14
text = "Level 5 - Final Trial
More enemies, tighter corridors, and harsher patrols.
Use every mask and timing trick you've learned!"

[node name="Walls" type="Node2D" parent="."]

[node name="WallTop" type="StaticBody2D" parent="Walls"]
position = Vector2(1024, 8)
collision_layer = 1
collision_mask = 0

[node name="CollisionShape2D" type="CollisionShape2D" parent="Walls/WallTop"]
shape = SubResource("RectangleShape2D_wall_h")

[node name="ColorRect" type="ColorRect" parent="Walls/WallTop"]
offset_left = -1024.0
offset_top = -8.0
offset_right = 1024.0
offset_bottom = 8.0
color = Color(0.6, 0.4, 0.7, 1)

[node name="WallBottom" type="StaticBody2D" parent="Walls"]
position = Vector2(1024, 760)
collision_layer = 1
collision_mask = 0

[node name="CollisionShape2D" type="CollisionShape2D" parent="Walls/WallBottom"]
shape = SubResource("RectangleShape2D_wall_h")

[node name="ColorRect" type="ColorRect" parent="Walls/WallBottom"]
offset_left = -1024.0
offset_top = -8.0
offset_right = 1024.0
offset_bottom = 8.0
color = Color(0.6, 0.4, 0.7, 1)

[node name="WallLeft" type="StaticBody2D" parent="Walls"]
position = Vector2(8, 384)
collision_layer = 1
collision_mask = 0

[node name="CollisionShape2D" type="CollisionShape2D" parent="Walls/WallLeft"]
shape = SubResource("RectangleShape2D_wall_v")

[node name="ColorRect" type="ColorRect" parent="Walls/WallLeft"]
offset_left = -8.0
offset_top = -384.0
offset_right = 8.0
offset_bottom = 384.0
color = Color(0.6, 0.4, 0.7, 1)

[node name="WallRight" type="StaticBody2D" parent="Walls"]
position = Vector2(2040, 384)
collision_layer = 1
collision_mask = 0

[node name="CollisionShape2D" type="CollisionShape2D" parent="Walls/WallRight"]
shape = SubResource("RectangleShape2D_wall_v")

[node name="ColorRect" type="ColorRect" parent="Walls/WallRight"]
offset_left = -8.0
offset_top = -384.0
offset_right = 8.0
offset_bottom = 384.0
color = Color(0.6, 0.4, 0.7, 1)

# Central maze: tighter corridors and cross-shapes
[node name="MiddleWall1" type="StaticBody2D" parent="Walls"]
position = Vector2(320, 260)
collision_layer = 1
collision_mask = 0

[node name="CollisionShape2D" type="CollisionShape2D" parent="Walls/MiddleWall1"]
shape = SubResource("RectangleShape2D_obstacle")

[node name="ColorRect" type="ColorRect" parent="Walls/MiddleWall1"]
offset_left = -8.0
offset_top = -100.0
offset_right = 8.0
offset_bottom = 100.0
color = Color(0.6, 0.4, 0.7, 1)

[node name="MiddleWall2" type="StaticBody2D" parent="Walls"]
position = Vector2(704, 520)
collision_layer = 1
collision_mask = 0

[node name="CollisionShape2D" type="CollisionShape2D" parent="Walls/MiddleWall2"]
shape = SubResource("RectangleShape2D_obstacle")

[node name="ColorRect" type="ColorRect" parent="Walls/MiddleWall2"]
offset_left = -8.0
offset_top = -100.0
offset_right = 8.0
offset_bottom = 100.0
color = Color(0.6, 0.4, 0.7, 1)

[node name="Obstacle3" type="StaticBody2D" parent="Walls"]
position = Vector2(512, 200)
collision_layer = 1
collision_mask = 0

[node name="CollisionShape2D" type="CollisionShape2D" parent="Walls/Obstacle3"]
shape = SubResource("RectangleShape2D_obstacle_horizontal")

[node name="ColorRect" type="ColorRect" parent="Walls/Obstacle3"]
offset_left = -110.0
offset_top = -8.0
offset_right = 110.0
offset_bottom = 8.0
color = Color(0.6, 0.4, 0.7, 1)

[node name="Obstacle4" type="StaticBody2D" parent="Walls"]
position = Vector2(512, 600)
collision_layer = 1
collision_mask = 0

[node name="CollisionShape2D" type="CollisionShape2D" parent="Walls/Obstacle4"]
shape = SubResource("RectangleShape2D_obstacle_horizontal")

[node name="ColorRect" type="ColorRect" parent="Walls/Obstacle4"]
offset_left = -110.0
offset_top = -8.0
offset_right = 110.0
offset_bottom = 8.0
color = Color(0.6, 0.4, 0.7, 1)

[node name="Obstacle5" type="StaticBody2D" parent="Walls"]
position = Vector2(220, 520)
collision_layer = 1
collision_mask = 0

[node name="CollisionShape2D" type="CollisionShape2D" parent="Walls/Obstacle5"]
shape = SubResource("RectangleShape2D_obstacle_small")

[node name="ColorRect" type="ColorRect" parent="Walls/Obstacle5"]
offset_left = -8.0
offset_top = -60.0
offset_right = 8.0
offset_bottom = 60.0
color = Color(0.6, 0.4, 0.7, 1)

[node name="Obstacle6" type="StaticBody2D" parent="Walls"]
position = Vector2(820, 260)
collision_layer = 1
collision_mask = 0

[node name="CollisionShape2D" type="CollisionShape2D" parent="Walls/Obstacle6"]
shape = SubResource("RectangleShape2D_obstacle_small")

[node name="ColorRect" type="ColorRect" parent="Walls/Obstacle6"]
offset_left = -8.0
offset_top = -60.0
offset_right = 8.0
offset_bottom = 60.0
color = Color(0.6, 0.4, 0.7, 1)

[node name="Bar1" type="StaticBody2D" parent="Walls"]
position = Vector2(350, 350)
collision_layer = 1
collision_mask = 0

[node name="CollisionShape2D" type="CollisionShape2D" parent="Walls/Bar1"]
shape = SubResource("RectangleShape2D_bar_short_h")

[node name="ColorRect" type="ColorRect" parent="Walls/Bar1"]
offset_left = -40.0
offset_top = -6.0
offset_right = 40.0
offset_bottom = 6.0
color = Color(0.6, 0.4, 0.7, 1)

[node name="Bar2" type="StaticBody2D" parent="Walls"]
position = Vector2(550, 500)
collision_layer = 1
collision_mask = 0

[node name="CollisionShape2D" type="CollisionShape2D" parent="Walls/Bar2"]
shape = SubResource("RectangleShape2D_bar_short_v")

[node name="ColorRect" type="ColorRect" parent="Walls/Bar2"]
offset_left = -6.0
offset_top = -40.0
offset_right = 6.0
offset_bottom = 40.0
color = Color(0.6, 0.4, 0.7, 1)

[node name="Bar3" type="StaticBody2D" parent="Walls"]
position = Vector2(750, 250)
collision_layer = 1
collision_mask = 0

[node name="CollisionShape2D" type="CollisionShape2D" parent="Walls/Bar3"]
shape = SubResource("RectangleShape2D_bar_short_h")

[node name="ColorRect" type="ColorRect" parent="Walls/Bar3"]
offset_left = -40.0
offset_top = -6.0
offset_right = 40.0
offset_bottom = 6.0
color = Color(0.6, 0.4, 0.7, 1)

[node name="Bar4" type="StaticBody2D" parent="Walls"]
position = Vector2(950, 550)
collision_layer = 1
collision_mask = 0

[node name="CollisionShape2D" type="CollisionShape2D" parent="Walls/Bar4"]
shape = SubResource("RectangleShape2D_bar_short_v")

[node name="ColorRect" type="ColorRect" parent="Walls/Bar4"]
offset_left = -6.0
offset_top = -40.0
offset_right = 6.0
offset_bottom = 40.0
color = Color(0.6, 0.4, 0.7, 1)

[node name="Bar5" type="StaticBody2D" parent="Walls"]
position = Vector2(1150, 300)
collision_layer = 1
collision_mask = 0

[node name="CollisionShape2D" type="CollisionShape2D" parent="Walls/Bar5"]
shape = SubResource("RectangleShape2D_bar_short_h")

[node name="ColorRect" type="ColorRect" parent="Walls/Bar5"]
offset_left = -40.0
offset_top = -6.0
offset_right = 40.0
offset_bottom = 6.0
color = Color(0.6, 0.4, 0.7, 1)

[node name="Bar6" type="StaticBody2D" parent="Walls"]
position = Vector2(1350, 600)
collision_layer = 1
collision_mask = 0

[node name="CollisionShape2D" type="CollisionShape2D" parent="Walls/Bar6"]
shape = SubResource("RectangleShape2D_bar_short_v")

[node name="ColorRect" type="ColorRect" parent="Walls/Bar6"]
offset_left = -6.0
offset_top = -40.0
offset_right = 6.0
offset_bottom = 40.0
color = Color(0.6, 0.4, 0.7, 1)

[node name="Bar7" type="StaticBody2D" parent="Walls"]
position = Vector2(1550, 200)
collision_layer = 1
collision_mask = 0

[node name="CollisionShape2D" type="CollisionShape2D" parent="Walls/Bar7"]
shape = SubResource("RectangleShape2D_bar_short_h")

[node name="ColorRect" type="ColorRect" parent="Walls/Bar7"]
offset_left = -40.0
offset_top = -6.0
offset_right = 40.0
offset_bottom = 6.0
color = Color(0.6, 0.4, 0.7, 1)

[node name="Bar8" type="StaticBody2D" parent="Walls"]
position = Vector2(1750, 500)
collision_layer = 1
collision_mask = 0

[node name="CollisionShape2D" type="CollisionShape2D" parent="Walls/Bar8"]
shape = SubResource("RectangleShape2D_bar_short_v")

[node name="ColorRect" type="ColorRect" parent="Walls/Bar8"]
offset_left = -6.0
offset_top = -40.0
offset_right = 6.0
offset_bottom = 40.0
color = Color(0.6, 0.4, 0.7, 1)

[node name="Bar9" type="StaticBody2D" parent="Walls"]
position = Vector2(400, 150)
collision_layer = 1
collision_mask = 0

[node name="CollisionShape2D" type="CollisionShape2D" parent="Walls/Bar9"]
shape = SubResource("RectangleShape2D_bar_short_h")

[node name="ColorRect" type="ColorRect" parent="Walls/Bar9"]
offset_left = -40.0
offset_top = -6.0
offset_right = 40.0
offset_bottom = 6.0
color = Color(0.6, 0.4, 0.7, 1)

[node name="Bar10" type="StaticBody2D" parent="Walls"]
position = Vector2(1200, 150)
collision_layer = 1
collision_mask = 0

[node name="CollisionShape2D" type="CollisionShape2D" parent="Walls/Bar10"]
shape = SubResource("RectangleShape2D_bar_short_v")

[node name="ColorRect" type="ColorRect" parent="Walls/Bar10"]
offset_left = -6.0
offset_top = -40.0
offset_right = 6.0
offset_bottom = 40.0
color = Color(0.6, 0.4, 0.7, 1)

[node name="Player" parent="." instance=ExtResource("1_player")]
position = Vector2(96, 704)

# Mixed enemy types: more, with varied patrols
[node name="Enemy1" parent="." instance=ExtResource("26_indigo")]
position = Vector2(260, 520)
patrol_distance = 120.0
patrol_pattern = 3

[node name="Enemy2" parent="." instance=ExtResource("26_indigo")]
position = Vector2(512, 384)
patrol_distance = 140.0
patrol_pattern = 0

[node name="Enemy3" parent="." instance=ExtResource("26_indigo")]
position = Vector2(820, 520)
patrol_distance = 120.0
patrol_pattern = 1

[node name="Enemy4" parent="." instance=ExtResource("26_indigo")]
position = Vector2(820, 200)
patrol_distance = 140.0
patrol_pattern = 0

[node name="Enemy5" parent="." instance=ExtResource("26_indigo")]
position = Vector2(320, 260)
patrol_distance = 100.0
patrol_pattern = 1

[node name="DetectorEnemy1" parent="." instance=ExtResource("21_detector")]
position = Vector2(512, 260)
patrol_distance = 80.0
patrol_pattern = 2

[node name="DetectorEnemy2" parent="." instance=ExtResource("21_detector")]
position = Vector2(512, 520)
patrol_distance = 80.0
patrol_pattern = 2

[node name="HunterEnemy1" parent="." instance=ExtResource("22_hunter")]
position = Vector2(260, 200)
patrol_distance = 150.0

[node name="MimicEnemy1" parent="." instance=ExtResource("23_mimic")]
position = Vector2(764, 600)
patrol_distance = 80.0
patrol_pattern = 1

[node name="MimicEnemy2" parent="." instance=ExtResource("23_mimic")]
position = Vector2(400, 200)
patrol_distance = 80.0
patrol_pattern = 1

[node name="Enemy6" parent="." instance=ExtResource("26_indigo")]
position = Vector2(1100, 450)
patrol_distance = 130.0
patrol_pattern = 2

[node name="Enemy7" parent="." instance=ExtResource("26_indigo")]
position = Vector2(1300, 300)
patrol_distance = 120.0
patrol_pattern = 0

[node name="Enemy8" parent="." instance=ExtResource("26_indigo")]
position = Vector2(1500, 550)
patrol_distance = 110.0
patrol_pattern = 1

[node name="Enemy9" parent="." instance=ExtResource("26_indigo")]
position = Vector2(1700, 250)
patrol_distance = 140.0
patrol_pattern = 0

[node name="DetectorEnemy3" parent="." instance=ExtResource("21_detector")]
position = Vector2(1200, 600)
patrol_distance = 100.0
patrol_pattern = 1

[node name="DetectorEnemy4" parent="." instance=ExtResource("21_detector")]
position = Vector2(1600, 150)
patrol_distance = 95.0
patrol_pattern = 2

[node name="HunterEnemy2" parent="." instance=ExtResource("22_hunter")]
position = Vector2(1400, 400)
patrol_distance = 150.0

[node name="MimicEnemy3" parent="." instance=ExtResource("23_mimic")]
position = Vector2(1800, 500)
patrol_distance = 85.0
patrol_pattern = 1

# More hazards: lasers and cameras
[node name="LaserBarrier1" parent="." instance=ExtResource("17_laser")]
position = Vector2(352, 160)

[node name="LaserBarrier2" parent="." instance=ExtResource("17_laser")]
position = Vector2(672, 640)

[node name="LaserBarrier3" parent="." instance=ExtResource("17_laser")]
position = Vector2(512, 384)

[node name="SecurityCamera1" parent="." instance=ExtResource("18_security")]
position = Vector2(64, 96)
rotation = 0.0
rotation_range = 120.0

[node name="SecurityCamera2" parent="." instance=ExtResource("18_security")]
position = Vector2(960, 96)
rotation = 3.14159
rotation_range = 120.0

[node name="PatrollingLaser1" parent="." instance=ExtResource("19_patrol")]
position = Vector2(512, 96)
sweep_distance = 200.0

[node name="OneWayDoor1" parent="." instance=ExtResource("20_oneway")]
position = Vector2(256, 640)
passable_from = 0

[node name="ExitDoor" parent="." instance=ExtResource("3_door")]
position = Vector2(2000, 384)
next_level_path = "res://level/level_06.tscn"
requires_boss = false

[node name="HUD" parent="." instance=ExtResource("4_hud")]

[node name="LevelManager" type="Node" parent="."]
script = ExtResource("6_levelmgr")
spawn_enemy_scene = ExtResource("26_indigo")

[node name="BackgroundGenerator" type="Node2D" parent="."]
script = ExtResource("5_bg")
color_scheme = 4
pattern_density = 1.5
level_width = 2048.0
level_height = 768.0

[node name="MaskLighting" type="Node2D" parent="."]
script = ExtResource("15_lighting")

[node name="AmbientEffects" type="Node2D" parent="."]
script = ExtResource("16_ambient")

